<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" ></script>

    <script src="checkout.js" defer ></script>
    <script src="../script.js" defer></script>
    <script src="https://kit.fontawesome.com/e24507d923.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" />


    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <title>Green farm | {% block title %} {% endblock %}</title>
    <style>
      /* Ki·ªÉu chatbox ·ªü g√≥c d∆∞·ªõi b√™n ph·∫£i */
      #chatbox-container {
          position: fixed;
          bottom: 0px;
          right: 0px;
          width: 300px;
          height: 432px;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 10px 10px 0 0;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          opacity: 0.9;  
          filter: alpha(opacity=30);
          display: none ;  
          z-index: 10000;  /* ƒê·∫£m b·∫£o chatbox n·ªïi tr√™n c√°c ph·∫ßn t·ª≠ kh√°c */
      }

      #chatbox-header {
        background-color: #007bff;
        color: white;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        position: relative;
      }

      #minimize-chatbox {
          position: absolute;
          top: 5px;
          right: 10px;
          background-color: #007bff;
          border: 1px solid  #007bff;
          font-size: 18px;
          padding: 5px;
          cursor: pointer;
      }

      #minimize-icon {
          font-size: 18px;
          font-weight: bold;
          display: inline-block;
      }

      #minimize-chatbox::before {
          content: "_";  /* T·∫°o g·∫°ch ngang */
          font-size: 24px;
          font-weight: bold;
          position: absolute;
          top: 0;
          right: 0;
          transform: translateY(-50%);  /* CƒÉn ch·ªânh g·∫°ch ngang v·ªõi v·ªã tr√≠ c·ªßa n√∫t */
      }


      #chatbox-body {
          padding: 10px;
          height: 300px;
          overflow-y: auto;
          background-color: #f9f9f9;
      }

      #chatbox-footer {
          padding: 10px;
          border-radius: 5px;
          border-top: 1px solid #ccc;
      }

      #user-message {
          width: 80%;
          padding: 5px;
      }

      #send-btn {
        width: 17%;
        padding: 5px;
        cursor: pointer;
        border: none;
        background-color: #007bff;
        color: white;
        font-size: 16px;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }
    
    #send-btn:hover {
        background-color: #0056b3;
    }

      /* N√∫t m·ªü chatbox */
      #open-chatbox {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 50%;
          width: 50px;
          height: 50px;
          font-size: 24px;
          cursor: pointer;
          z-index: 10;  /* N√∫t m·ªü lu√¥n n·ªïi tr√™n chatbox */
      }
      .admin-page{
          color: rgb(0, 0, 0,0.65);;
      }
      .admin-page:hover {
          color: rgb(228, 150, 7);;
      }
</style>
</head>
<body style="background-color: rgb(13, 173, 53);">


    <!-- navbar section -->
    <nav class="navbar navbar-expand-lg" style="background-color: white;">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" style="color: orange; font-size: 30px; margin-right: -2px;">
          <i class="fa-solid fa-wheat-awn"></i>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/" style="font-family: cursive; font-size: 19px;">Green farm</a>
            </li>

            <li class="nav-item">
              <a class="nav-link text-grey" href="#" style="font-size: 17px;">Th√¥ng tin</a>
            </li>

            <li class="nav-item">
              <a class="nav-link text-grey" href="#" style="font-size: 17px;">Li√™n h·ªá</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-grey" href="/index" style="font-size: 17px;">Th·ªùi ti·∫øt</a>
            </li>
          </ul>

          <form class="d-flex" role="search" action="/search" style="margin-right: 50px;" method="POST">
            <input class="form-control me-2" name="search" type="search" placeholder="T√¨m ki·∫øm" aria-label="T√¨m ki·∫øm">
            <button class="btn" type="submit">T√¨m ki·∫øm</button>
          </form>
        </div>

            <!-- Hi·ªÉn th·ªã link Admin Page n·∫øu ng∆∞·ªùi d√πng l√† admin -->
            {% if session.get('is_admin') %}
            <a class="nav-link text-grey admin-page" href="/admin-page"><span class="badge bg-success"></span> Admin Page</a>
            {% endif %}
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

          <li class="nav-item mx-2" id="items">
            
            {% if cart | length < 1 %}
            <a class="nav-link text-grey" href="/cart"><span class="badge bg-success"></span> Gi·ªè h√†ng
              <i class="fa-solid fa-cart-shopping"></i>
            </a>
            {% else %}
            <a class="nav-link text-grey" href="/cart"><span class="badge bg-success"></span> Gi·ªè h√†ng
              <i class="bi bi-{{ cart | length }}-square-fill"></i>
            </a>
            
            {% endif %}
            
            
          </li>

          <li class="nav-item mx-2" id="items">
            <a class="nav-link text-grey" href="#"><span class="badge bg-success"></span> Danh s√°ch mong mu·ªën
              <i class="fa-solid fa-heart"></i>
            </a>
          </li>

          
          <li class="nav-item dropdown mx-2">
            <a class="nav-link dropdown-toggle text-grey" href="#" role="button", id="profileDropdown" 
            data-bs-toggle="dropdown" aria-hidden="false">
              T√†i kho·∫£n
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">

            
              {% if current_user.is_authenticated %}
              <li><a class="dropdown-item" href="/profile/{{ current_user.id }}">Th√¥ng tin c√° nh√¢n <i class="fa-solid fa-user"></i></a></li>
              <li><a class="dropdown-item" href="/orders">ƒê∆°n h√†ng<i class="fa-solid fa-truck-fast"></i></a></li>
              <li><a class="dropdown-item" href="/logout">ƒêƒÉng xu·∫•t <i class="fa-solid fa-right-from-bracket"></i></a></li>

              {% else %}
              
              <li><a class="dropdown-item" href="/login">ƒêƒÉng nh·∫≠p <i class="fa-solid fa-right-to-bracket"></i></a></li>

              {% endif %}

            </ul>

          </li>

        </ul>


      </div>
    </nav>


    {% for message in get_flashed_messages() %}

    <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-top: 5px;">
        <strong>{{ message }}</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    
    </div>
    {% endfor %}

    {% block body %}


    {% endblock %}

     <!-- N√∫t m·ªü chatbox -->
     <button id="open-chatbox">üí¨</button>

     <!-- Chatbox -->
     <div id="chatbox-container">
         <div id="chatbox-header">
          <span>Chat with Bot</span>
             <div id="minimize-chatbox">
              <span id="minimize-icon"></span>  <!-- G·∫°ch ngang -->
          </div>
         </div>
         <div id="chatbox-body">
             <!-- C√°c tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
         </div>
         <div id="chatbox-footer">
          <input type="text" id="user-message" placeholder="Type a message..." autocomplete="off">
             <button class="col" id="send-btn">‚û§</button>
             <input type="file" id="image-upload" accept="image/*" style="display: none;">
             <button id="upload-btn">üì∑ Upload Image</button>
         </div>
     </div>
 
     <script>
        document.getElementById("upload-btn").addEventListener("click", function() {
          document.getElementById("image-upload").click();
      });

      // G·ª≠i ·∫£nh l√™n server khi ng∆∞·ªùi d√πng ch·ªçn file
      // B·∫Øt s·ª± ki·ªán khi ch·ªçn ·∫£nh
      let selectedFile = null;

      document.getElementById("image-upload").addEventListener("change", function () {
        selectedFile = this.files[0];
      });
      // JavaScript to open/close the chatbox
      document.getElementById("open-chatbox").addEventListener("click", function() {
          var chatbox = document.getElementById("chatbox-container");
          chatbox.style.display = (chatbox.style.display === "none" || chatbox.style.display === "") ? "block" : "none";
      });
       // Thu nh·ªè ho·∫∑c ƒë√≥ng chatbox khi nh·∫•n v√†o g·∫°ch ngang
       document.getElementById("minimize-chatbox").onclick = function() {
              var chatbox = document.getElementById("chatbox-container");

              // ·∫®n chatbox khi nh·∫•n v√†o g·∫°ch ngang
              chatbox.style.display = "none";   
          };
          document.addEventListener("keydown", function(event) {
              if (event.key === "Escape") { // Ki·ªÉm tra ph√≠m Esc
                  var chatbox = document.getElementById("chatbox-container");
                  chatbox.style.display = "none"; // ·∫®n chatbox khi nh·∫•n Esc
              }
          });
              // H√†m g·ª≠i tin nh·∫Øn
              function sendMessage() {
                var userMessage = document.getElementById("user-message").value;
                var chatboxBody = document.getElementById("chatbox-body");
            
                // Hi·ªÉn th·ªã tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng
                if (userMessage.trim() !== "" || selectedFile) {
                    var newMessage = document.createElement("div");
                    newMessage.classList.add("user-message");
                    newMessage.textContent = "B·∫°n: " + userMessage;
                    chatboxBody.appendChild(newMessage);

                    // T·∫°o FormData ƒë·ªÉ g·ª≠i c·∫£ vƒÉn b·∫£n v√† file
                    const formData = new FormData();
                    if (userMessage.trim() !== "") {
                        formData.append("user_message", userMessage); // Th√™m vƒÉn b·∫£n
                    }
                    if (selectedFile) {
                        formData.append("image", selectedFile); // Th√™m file ·∫£nh
                        var userImage = document.createElement("img");
                        userImage.src = URL.createObjectURL(selectedFile); // T·∫°o URL t·∫°m th·ªùi cho ·∫£nh
                        userImage.style.maxWidth = "100px";
                        userImage.style.marginTop = "5px";
                        userImage.style.borderRadius = "8px";
                        chatboxBody.appendChild(userImage);
                    }
            
                    // G·ª≠i d·ªØ li·ªáu ƒë·∫øn server
                    fetch("/chat", {
                        method: "POST",
                        body: formData, // D√πng FormData
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            // Hi·ªÉn th·ªã ph·∫£n h·ªìi c·ªßa bot
                            var botMessage = document.createElement("div");
                            botMessage.classList.add("bot-message");
                            if (data.image_url) {
                                botMessage.innerHTML = `
                                    <p>Bot: ${data.bot_reply}</p>
                                    <img src="${data.image_url}" alt="Image" style="max-width: 100%; height: auto;">`;
                            } else {
                                botMessage.innerHTML = "Bot: " + data.bot_reply;
                            }
                            chatboxBody.appendChild(botMessage);
                            chatboxBody.scrollTop = chatboxBody.scrollHeight; // Cu·ªôn xu·ªëng d∆∞·ªõi
                        })
                        .catch((error) => console.error("L·ªói:", error));
            
                    // X√≥a n·ªôi dung trong √¥ nh·∫≠p sau khi g·ª≠i v√† reset file ·∫£nh
                    document.getElementById("user-message").value = "";
                    selectedFile = null;
                    document.getElementById("image-upload").value = ""; // Reset input file
                }
            }

          // G·ª≠i tin nh·∫Øn khi nh·∫•n n√∫t Send
          document.getElementById("send-btn").addEventListener("click", sendMessage);

          // G·ª≠i tin nh·∫Øn khi nh·∫•n ph√≠m Enter
          document.getElementById("user-message").addEventListener("keydown", function(event) {
              if (event.key === "Enter") { // Ki·ªÉm tra ph√≠m Enter
                  event.preventDefault(); // NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh (n·∫øu c√≥)
                  sendMessage(); // G·ªçi h√†m g·ª≠i tin nh·∫Øn
              }
          });

  </script>
    <footer class="container-fluid  text-center p-2 mt-5" style="background-color: orange; color: white;">
      <a href="https://github.com/users/xuancu1103/projects/4" style="color: white;">Green farm</a> | <span>
        <i class="fa-sharp fa-regular fa-copyright"></i></span>
    </footer>

    <script src="{{ url_for( 'static', filename='js/owl.carousel.min.js') }}"></script>
    <script src="{{ url_for( 'static', filename='js/all.min.js') }}"></script>
    <script src="{{ url_for( 'static', filename='js/jquery.js') }}"></script>

    <script src="{{ url_for( 'static', filename='js/myScript.js') }}"></script>

       

</body>
    






    
    
</body>
</html>